{% extends 'base.html' %}
{% block title %}Insurance Claims{% endblock %}
{% block content %}
<h2>Your Claims</h2>
<a href="{% url 'create-claim' %}" class="btn btn-warning">Submit New Claim</a>
<ul class="list-group mt-3">
    {% for claim in claims %}
    <li class="list-group-item">
        <strong>Status:</strong> {{ claim.status }} <br>
        <strong>Details:</strong> {{ claim.details }}
    </li>
    {% endfor %}
</ul>

<script>
    $(document).ready(function () {
        $("#claim-form").submit(function (event) {
            event.preventDefault();

            let formData = $(this).serialize();

            $.ajax({
                url: "/api/submit-claim/",
                type: "POST",
                data: formData,
                success: function (response) {
                    $("#claim-message").text(response.message).addClass("alert alert-success").show();
                    $("#claim-form")[0].reset();
                },
                error: function (xhr) {
                    $("#claim-message").text("Error: " + xhr.responseText).addClass("alert alert-danger").show();
                }
            });
        });
    });
</script>

<form id="claim-form">
    {% csrf_token %}
    <textarea name="details" class="form-control" placeholder="Describe your claim..." required></textarea>
    <button type="submit" class="btn btn-warning mt-2">Submit Claim</button>
</form>

<div id="claim-message" style="display: none;"></div>
{% endblock %}